@using property_lease_saas.Models.Entities
@model IEnumerable<Property>

<div class="container-fluid">
    <h1 class="mb-4">Available Properties</h1>

    <div class="row">
        @foreach (var p in Model)
        {
            var carouselId = $"carousel-{p.Id}";
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm h-100 property-card">

                    <!-- IMAGE DRUM / CAROUSEL -->
                    @if (p.Images != null && p.Images.Any())
                    {
                        <div class="property-carousel">
                            <div id="@carouselId" class="carousel slide" data-bs-ride="carousel" data-bs-pause="hover">
                                <div class="carousel-inner">
                                    @for (int i = 0; i < p.Images.Count; i++)
                                    {
                                        var img = p.Images.ElementAt(i);
                                        <div class="carousel-item @(i == 0 ? "active" : "")">
                                            <img src="@img.FilePath" class="d-block w-100" style="height:220px; object-fit:cover;" alt="Property image">
                                        </div>
                                    }
                                </div>

                                @* Only show controls if multiple images *@
                                @if (p.Images.Count > 1)
                                {
                                    <button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon"></span>
                                    </button>

                                    <button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
                                        <span class="carousel-control-next-icon"></span>
                                    </button>
                                }

                                <span class="position-absolute bottom-0 end-0 m-2 badge bg-dark bg-opacity-75">@p.Images.Count photos</span>
                            </div>
                        </div>
                    }
                    else
                    {
                        <img src="/images/no-image.png" class="card-img-top" style="height:220px; object-fit:cover;" alt="No image available">
                    }

                    <!-- CARD BODY -->
                    <div class="card-body">
                        <h5>@p.Title</h5>
                        <p class="text-muted">@p.Description</p>
                        <p><strong>Address:</strong> @p.Address</p>
                        <p><strong>Rs. @p.Rent</strong></p>

                        <form asp-controller="Lease" asp-action="RequestLease" method="post">
                            <input type="hidden" name="propertyId" value="@p.Id" />
                            <button type="submit" class="btn btn-success w-100">Request Lease</button>
                        </form>

                    </div>
                </div> <!-- card -->
                    


            </div> <!-- col -->
        }
    </div> <!-- row -->
</div> <!-- container -->


@if (TempData["Error"] != null)
{
    <div class="alert alert-danger d-inline-flex align-items-center px-3 py-2 mt-3"
     style="font-size: 0.9rem; border-radius: 6px;">
        <i class="bi bi-exclamation-triangle me-2">
        @TempData["Error"]
        </i>
    </div> 
}
@if (TempData["Success"] != null)
{
    <div class="alert alert-success d-inline-flex align-items-center px-3 py-2 mt-3"
        style="font-size: 0.9rem; border-radius: 6px;">
        <i class="bi bi-check-circle me-2"></i>
        @TempData["Success"]
    </div>
}


